{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/IT09/Music/pms/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"C:/Users/IT09/Music/pms/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"C:/Users/IT09/Music/pms/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/IT09/Music/pms/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/**\r\n * @author Rido Martupa Simbolon\r\n */import React,{useState,useEffect}from'react';import axios from\"axios\";import{NavLink,useNavigate}from\"react-router-dom\";import{ToastContainer,toast}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import{MultiSelect}from\"react-multi-select-component\";import Select from'react-select';import'../css/project.css';import{useSelector}from'react-redux';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ProjectNew=function ProjectNew(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),picTaskSelected=_useState2[0],setPicTaskSelected=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),selected=_useState4[0],setSelected=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),isDisabled=_useState6[0],setIsDisabled=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),projectname=_useState8[0],setProjectname=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),description=_useState10[0],setDescription=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),bagdept=_useState12[0],setBagdept=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),subbagdept=_useState14[0],setSubbagdept=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),options=_useState16[0],setOptions=_useState16[1];var _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),startproj=_useState18[0],setStartproj=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),startDate=_useState20[0],setStartDate=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),dueDate=_useState22[0],setDueDate=_useState22[1];var _useState23=useState(\"\"),_useState24=_slicedToArray(_useState23,2),endproj=_useState24[0],setEndproj=_useState24[1];var _useSelector=useSelector(function(state){return state.auth;}),user=_useSelector.user;var uuid='';var role='';if(user!==null){uuid=user.uuid;role=user.role;}var _useState25=useState(\"\"),_useState26=_slicedToArray(_useState25,2),msg=_useState26[0],setMsg=_useState26[1];var navigate=useNavigate();var _useState27=useState([]),_useState28=_slicedToArray(_useState27,2),list=_useState28[0],updateList=_useState28[1];var _useState29=useState(''),_useState30=_slicedToArray(_useState29,2),items=_useState30[0],setItem=_useState30[1];var _useState31=useState(''),_useState32=_slicedToArray(_useState31,2),bobot=_useState32[0],setBobot=_useState32[1];var _useState33=useState(''),_useState34=_slicedToArray(_useState33,2),pictask=_useState34[0],setPicTask=_useState34[1];var _useState35=useState([]),_useState36=_slicedToArray(_useState35,2),depts=_useState36[0],setDept=_useState36[1];var _useState37=useState([]),_useState38=_slicedToArray(_useState37,2),subdept=_useState38[0],setSubDept=_useState38[1];var getDataUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var dataUser;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsDisabled(false);setOptions([]);_context.next=4;return axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/users\"));case 4:dataUser=_context.sent;dataUser.data.forEach(function(dtUsr){var dataUser={label:dtUsr.name,value:dtUsr.id,uid:dtUsr.uuid};setOptions(function(oldArray){return[].concat(_toConsumableArray(oldArray),[dataUser]);});});case 6:case\"end\":return _context.stop();}}},_callee);}));return function getDataUser(){return _ref.apply(this,arguments);};}();var getDataDept=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var dataDept;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/getdept\"));case 2:dataDept=_context2.sent;setDept(dataDept.data);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function getDataDept(){return _ref2.apply(this,arguments);};}();useEffect(function(){getDataDept();},[]);// hitung bobot\nvar sum=list.reduce(function(prev,current){return prev+ +current.bobot;},0);var handleDept=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(e){var dataSubDept;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setBagdept(e);_context3.next=3;return axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/getsubdept/\").concat(e));case 3:dataSubDept=_context3.sent;setSubDept(dataSubDept.data);case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function handleDept(_x){return _ref3.apply(this,arguments);};}();var handleRemoveItem=function handleRemoveItem(id){updateList(list.filter(function(item){return item.task!==id;}));};var handleAddItem=function handleAddItem(e){updateList([].concat(_toConsumableArray(list),[{task:items.toUpperCase(),bobot:bobot,pic:picTaskSelected,startdate:startDate,duedate:dueDate}]));setItem(\"\");setBobot(\"\");setPicTask(\"\");setStartDate(\"\");setDueDate(\"\");};var saveProject=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(e){var partpnt,response;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:partpnt={\"data\":[]};e.preventDefault();if(!(sum>100)){_context4.next=6;break;}toast.error(/*#__PURE__*/_jsx(\"small\",{children:\"Gagal tambah project baru. Total bobot melebihi 100.\"}),{theme:\"colored\"});_context4.next=17;break;case 6:selected.forEach(function(el){return[partpnt.data=[].concat(_toConsumableArray(partpnt.data),[el])];});_context4.prev=7;_context4.next=10;return axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/projects\"),{projectname:projectname,description:description,bagdept:bagdept,subbagdept:subbagdept,participant:JSON.stringify(partpnt),location:list,ttlitem:list.length,ttlbobot:0,startproj:startproj,endproj:endproj,status:'OPEN',inputby:role.toUpperCase(),uid:uuid});case 10:response=_context4.sent;if(response){toast.success(/*#__PURE__*/_jsx(\"small\",{children:\"Berhasil tambah project baru.\"}),{theme:\"colored\"});setTimeout(function(){navigate('/projects');},3000);}_context4.next=17;break;case 14:_context4.prev=14;_context4.t0=_context4[\"catch\"](7);if(_context4.t0.response){setMsg(_context4.t0.response.data.msg);}case 17:case\"end\":return _context4.stop();}}},_callee4,null,[[7,14]]);}));return function saveProject(_x2){return _ref4.apply(this,arguments);};}();var handleChangePicTask=function handleChangePicTask(selectedOption){setPicTaskSelected(selectedOption);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"container-fluid mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-sm-flex align-items-center justify-content-between mb-2\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"h3 mb-3 text-gray-800\",children:\"New Project Page\"}),/*#__PURE__*/_jsx(\"nav\",{\"aria-label\":\"breadcrumb\",children:/*#__PURE__*/_jsxs(\"ol\",{className:\"breadcrumb\",children:[/*#__PURE__*/_jsx(\"li\",{className:\"breadcrumb-item\",children:/*#__PURE__*/_jsx(NavLink,{to:\"/dashboard\",children:\"Dashboard\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"breadcrumb-item\",children:/*#__PURE__*/_jsx(NavLink,{to:\"/projects\",children:\"Projects\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"breadcrumb-item active\",\"aria-current\":\"page\",children:\"New\"})]})})]}),/*#__PURE__*/_jsx(\"form\",{onSubmit:saveProject,children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-6 mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card shadow mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header py-3\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"m-0 font-weight-bold text-primary\",children:\"Form New Project\"}),/*#__PURE__*/_jsx(\"small\",{className:\"text-center text-warning\",children:msg})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"inputProjectName\",children:\"Project Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",value:projectname,onChange:function onChange(e){return setProjectname(e.target.value);},\"aria-describedby\":\"projectName\",placeholder:\"Enter project name\",autoFocus:true,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"inputProjectDescription\",children:\"Project Description\"}),/*#__PURE__*/_jsx(\"textarea\",{type:\"text\",className:\"form-control\",value:description,onChange:function onChange(e){return setDescription(e.target.value);},placeholder:\"Enter your project description here\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"selectProjectTeam\",children:\"Project Participant\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(MultiSelect,{disabled:isDisabled,options:options,value:selected,onChange:setSelected,labelledBy:\"Select\",isCreatable:true,className:\"col\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:getDataUser,className:\"btn btn-primary mr-3\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-refresh\"}),\"Load Users\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"selectProjectOwner\",children:\"Project Owner Division\"}),/*#__PURE__*/_jsx(\"input\",{list:\"data_div\",className:\"form-control\",value:bagdept,onChange:function onChange(e){return handleDept(e.target.value);},placeholder:\"Enter department to select owner\",required:true}),/*#__PURE__*/_jsx(\"datalist\",{id:\"data_div\",children:depts.map(function(dept,index){return/*#__PURE__*/_jsx(\"option\",{value:dept.kddept,children:dept.nmdept},index);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"selectProjectOwner\",children:\"Project Owner Sub-Div\"}),/*#__PURE__*/_jsx(\"input\",{list:\"data_subdiv\",className:\"form-control\",value:subbagdept,onChange:function onChange(e){return setSubbagdept(e.target.value);},placeholder:\"Enter division to select owner\",required:true}),/*#__PURE__*/_jsx(\"datalist\",{id:\"data_subdiv\",children:subdept.map(function(item,index){return/*#__PURE__*/_jsx(\"option\",{value:item.kdsubdept,children:item.nmsubdept},index);})})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-6 mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card shadow mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header py-3\",children:/*#__PURE__*/_jsx(\"h6\",{className:\"m-0 font-weight-bold text-primary\",children:\"Next Configuration\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"inputProjectDueDate\",children:\"Project Due Date\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"row d-flex justify-content-lg-between align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-sm-5\",children:/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"form-control\",value:startproj,onChange:function onChange(e){return setStartproj(e.target.value);},required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"\",children:\" S/D \"}),/*#__PURE__*/_jsx(\"div\",{className:\"col-sm-5\",children:/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"form-control\",value:endproj,onChange:function onChange(e){return setEndproj(e.target.value);},required:true})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group pt-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between mb-3\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"inputProjectDueDate\",children:[\"Project Task (Total Bobot: \",/*#__PURE__*/_jsx(\"b\",{children:sum}),\")\"]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-outline-success\",\"data-toggle\":\"modal\",\"data-target\":\"#addItemTask\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-plus-square\"}),\" Add Task\"]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex flex-wrap align-items-center\",children:list.map(function(item,index){return/*#__PURE__*/_jsx(\"div\",{task:item.task,className:\"bg-info rounded py-2 px-2 mr-2 mb-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center \",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-light mr-1\",children:/*#__PURE__*/_jsxs(\"small\",{children:[index+1,\".\"]})}),/*#__PURE__*/_jsx(\"span\",{className:\"text-light mr-2 \",children:/*#__PURE__*/_jsx(\"small\",{children:item.task+' ('+item.bobot+')'})}),/*#__PURE__*/_jsx(\"span\",{className:\"text-light badge badge-danger\",role:\"button\",onClick:function onClick(){return handleRemoveItem(item.task);},children:\"x\"})]})},index);})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-footer\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-sm btn-primary\",children:\" Submit\"})})]})})]})})]}),/*#__PURE__*/_jsx(ToastContainer,{icon:false,autoClose:3000}),/*#__PURE__*/_jsx(\"div\",{className:\"modal fade\",id:\"addItemTask\",tabIndex:-1,role:\"dialog\",\"aria-labelledby\":\"exampleModalLabel\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"div\",{className:\"modal-dialog\",role:\"document\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"modal-title\",id:\"itemTaskModalLabel\",children:\"New Task Item\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"close\",\"data-dismiss\":\"modal\",\"aria-label\":\"Close\",children:/*#__PURE__*/_jsx(\"span\",{\"aria-hidden\":\"true\",children:\"x\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Task Desc - Bobot\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group\",children:[/*#__PURE__*/_jsx(\"input\",{id:\"nit\",type:\"text\",className:\"form-control\",placeholder:\"new item task...\",value:items,onChange:function onChange(e){return setItem(e.target.value);}}),/*#__PURE__*/_jsx(\"input\",{id:\"bobot\",type:\"number\",step:1,className:\"form-control\",placeholder:\"bobot\",value:bobot,onChange:function onChange(e){return setBobot(e.target.value);}})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group my-2\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Start Date - Due Date Task\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"form-control\",value:startDate,onChange:function onChange(e){return setStartDate(e.target.value);},placeholder:\"start date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"form-control\",value:dueDate,onChange:function onChange(e){return setDueDate(e.target.value);},placeholder:\"due date\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group my-1\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Task PIC\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group\",children:[/*#__PURE__*/_jsx(Select,{options:options,value:picTaskSelected,onChange:handleChangePicTask}),/*#__PURE__*/_jsxs(\"button\",{onClick:getDataUser,className:\"btn btn-info ml-2\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-refresh\"}),\"Load Users\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"input-group my-3\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-primary\",onClick:handleAddItem,\"data-dismiss\":\"modal\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-plus-square\"}),\" Add Item\"]})}),/*#__PURE__*/_jsx(\"small\",{className:\"text-danger\",children:\"NB: item task baru harus berbeda dari yang lain. Bobot total task maksimal 100.\"})]})]})})})]});};export default ProjectNew;","map":null,"metadata":{},"sourceType":"module"}